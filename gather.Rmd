---
title: "Untitled"
author: "Scott Bek"
date: '2021 3 11 '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(lubridate)
library(skimr)
library(tidyverse)
```

```{r loading_CO}
co_june_to_oct <- read_csv("data/air_quality/CO.csv")
co_jan_to_may <- read_csv("data/air_quality/CO_20200101-20200531.csv")

co <- co_jan_to_may %>% 
  left_join(., co_june_to_oct)

# Solution for one city. Q: how to apply this to my entire dataset? 
     
co %>% 
  filter(City_EN == "Beijing") %>% 
  select(dplyr::starts_with("CO_Mean")) %>% 
  mutate(avg_co = sum(.)/356) %>% 
  select(avg_co)

# This worked!

co %>% 
  select(City_EN, starts_with("CO_Mean")) %>% 
  rowwise() %>% 
  mutate(avg_co = mean(c_across(CO_Mean_0101:CO_Mean_1221))) %>% 
  select(City_EN, avg_co)

co %>% 
  select(City_EN, CO_Mean_1221) %>% 
  summary()
```
```{r}
covid_confirmed <- read_csv("data/covid19/City_Confirmed_20200115_20210114.csv")
covid_death <- read_csv("data/covid19/City_Death_20200115_20210114.csv")

covid <- covid_confirmed %>% 
  left_join(., covid_death)

covid_death_plot <- covid %>% 
  select(City_EN, T_C_210114, T_D_210114) %>% 
  mutate(death_rate = T_D_210114 / T_C_210114) %>% 
  arrange(desc(death_rate)) %>% 
  filter(death_rate > 0.07) %>% 
  ggplot(aes(x = City_EN,
             y = death_rate)) +
  geom_col() +
  coord_flip() +
  labs(title = "Top 10 Chinese Cities with Highest COVID-19 Death Rate",
       x = "Cities",
       y = "Death Rates")
```

